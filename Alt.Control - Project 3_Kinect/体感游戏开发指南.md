# 体感捕捉游戏开发指南

## 📋 脚本分析总结

### ✅ 需要使用的脚本（已存在）

1. **`BodySourceManager.cs`** (位置: `Assets/kkk/KinectView/Scripts/`)
   - **作用**: 负责连接Kinect传感器并获取身体追踪数据
   - **是否需要修改**: ❌ 不需要，保持原样即可
   - **说明**: 这是Kinect数据的基础管理器，已经可以正常工作

2. **`BodySourceView.cs`** (位置: `Assets/kkk/KinectView/Scripts/`)
   - **作用**: 可视化显示身体骨架（用于调试）
   - **是否需要修改**: ⚠️ 可选，如果不需要可视化可以删除
   - **说明**: 这个脚本主要用于调试，看身体追踪是否正常

### 🆕 需要创建/修改的脚本

3. **`KinectPlayerController.cs`** (位置: `Assets/`)
   - **作用**: ⭐ **核心脚本** - 将Kinect身体数据转换为游戏控制
   - **是否需要修改**: ✅ **需要根据你的游戏需求修改**
   - **功能**:
     - 左右移动（基于身体左右倾斜）
     - 跳跃（基于身体向上移动）
     - 手势识别（举手、握拳等）
   - **使用方法**:
     1. 将此脚本附加到你的玩家角色GameObject上
     2. 在Inspector中设置`bodySourceManager`引用
     3. 调整参数（移动速度、跳跃力度等）

## 🎮 体感控制映射

### 当前实现的控制方式：

| 体感动作 | 游戏控制 | 实现方式 |
|---------|---------|---------|
| 身体左右倾斜 | 左右移动 | 基于`SpineBase`的X坐标 |
| 身体快速上移 | 跳跃 | 检测`SpineBase`的Y坐标变化 |
| 举手+握拳 | 手势事件 | 检测手部位置和状态 |

## 🔧 如何集成到你的游戏

### 步骤1: 设置Kinect基础
1. 确保场景中有`BodySourceManager`组件
2. 确保Kinect传感器已连接并正常工作

### 步骤2: 添加体感控制
1. 将`KinectPlayerController.cs`附加到玩家角色
2. 在Inspector中：
   - 设置`Body Source Manager`引用
   - 调整移动速度、跳跃力度等参数
   - 根据游戏类型启用/禁用手势控制

### 步骤3: 根据游戏类型自定义

#### 如果是Temple Run类型的跑酷游戏：
- 主要使用**左右移动**功能
- 可以添加**跳跃**来躲避障碍
- 可以添加**下蹲**（身体下移）来滑行

#### 如果是格斗游戏：
- 使用**手势识别**（举手、出拳）
- 可以检测**手部位置**来判断攻击方向

#### 如果是舞蹈游戏：
- 检测**多个关节位置**来匹配舞蹈动作
- 使用**身体姿态**来判断动作完成度

## 📝 需要修改的地方

### 1. `KinectPlayerController.cs` - 根据游戏需求调整

**移动控制部分** (第47-85行):
```csharp
// 可以修改：
- moveSpeed: 移动速度
- leanSensitivity: 倾斜灵敏度
- maxHorizontalMove: 最大移动范围
```

**跳跃控制部分** (第87-120行):
```csharp
// 可以修改：
- jumpForce: 跳跃力度
- jumpThreshold: 跳跃检测阈值
- crouchThreshold: 下蹲检测阈值
```

**手势控制部分** (第122-160行):
```csharp
// 可以添加自定义手势逻辑：
- OnLeftHandFist(): 左手握拳事件
- OnRightHandFist(): 右手握拳事件
```

### 2. 如果需要更复杂的控制，可以：

1. **添加更多手势检测**:
   - 双手举起（庆祝/防御）
   - 身体旋转（转向）
   - 腿部动作（踢腿）

2. **添加动作组合**:
   - 左右移动 + 举手 = 特殊技能
   - 下蹲 + 举手 = 防御姿态

3. **添加动作识别**:
   - 检测特定动作序列
   - 动作完成度评分

## 🎯 推荐修改顺序

1. ✅ **先测试基础功能**
   - 确保`BodySourceManager`正常工作
   - 测试`KinectPlayerController`的左右移动

2. ✅ **调整参数**
   - 根据实际体感效果调整灵敏度和阈值

3. ✅ **添加游戏特定功能**
   - 根据你的游戏类型添加特定控制
   - 例如：跑酷游戏添加滑行、格斗游戏添加攻击

4. ✅ **优化体验**
   - 添加平滑过渡
   - 添加防误触机制
   - 添加校准功能

## ⚠️ 注意事项

1. **Kinect坐标系**:
   - X轴: 左(-) 到 右(+)
   - Y轴: 下(-) 到 上(+)
   - Z轴: 近(-) 到 远(+)

2. **性能优化**:
   - Kinect数据更新频率约30fps
   - 建议使用插值平滑移动

3. **错误处理**:
   - 检查Kinect是否连接
   - 检查身体是否被追踪
   - 处理追踪丢失的情况

## 🔍 调试建议

1. 使用`BodySourceView`可视化身体骨架
2. 在`KinectPlayerController`中添加Debug.Log输出
3. 使用Gizmos显示移动范围（已实现）

## 📚 相关脚本位置

- Kinect基础脚本: `Assets/kkk/KinectView/Scripts/`
- 体感控制脚本: `Assets/KinectPlayerController.cs`
- 游戏逻辑脚本: `Assets/WeitingZhao/` (如果存在)

